import{b as i,_ as p,m as w,v as A,p as R}from"./index-Dx2hv2Bi.js";import{u as T,v as q,D as L}from"./index-BDw1ZPTA.js";function z(f,o){var l=T(o==null?void 0:o.client);q(f,L.Mutation);var E=i.useState({called:!1,loading:!1,client:l}),M=E[0],c=E[1],r=i.useRef({result:M,mutationId:0,isMounted:!0,client:l,mutation:f,options:o});Object.assign(r.current,{client:l,options:o,mutation:f});var k=i.useCallback(function(t){t===void 0&&(t={});var b=r.current,D=b.options,j=b.mutation,h=p(p({},D),{mutation:j}),d=t.client||r.current.client;!r.current.result.loading&&!h.ignoreResults&&r.current.isMounted&&c(r.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:d});var C=++r.current.mutationId,u=w(h,t);return d.mutate(u).then(function(n){var e,a,s=n.data,m=n.errors,v=m&&m.length>0?new A({graphQLErrors:m}):void 0,I=t.onError||((e=r.current.options)===null||e===void 0?void 0:e.onError);if(v&&I&&I(v,u),C===r.current.mutationId&&!u.ignoreResults){var _={called:!0,loading:!1,data:s,error:v,client:d};r.current.isMounted&&!R(r.current.result,_)&&c(r.current.result=_)}var g=t.onCompleted||((a=r.current.options)===null||a===void 0?void 0:a.onCompleted);return v||g==null||g(n.data,u),n}).catch(function(n){var e;if(C===r.current.mutationId&&r.current.isMounted){var a={loading:!1,error:n,data:void 0,called:!0,client:d};R(r.current.result,a)||c(r.current.result=a)}var s=t.onError||((e=r.current.options)===null||e===void 0?void 0:e.onError);if(s)return s(n,u),{data:void 0,errors:n};throw n})},[]),y=i.useCallback(function(){if(r.current.isMounted){var t={called:!1,loading:!1,client:l};Object.assign(r.current,{mutationId:0,result:t}),c(t)}},[]);return i.useEffect(function(){return r.current.isMounted=!0,function(){r.current.isMounted=!1}},[]),[k,p({reset:y},M)]}export{z as u};
